<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="csstransforms csstransforms3d csstransitions" lang="en"><head>
<link type="text/css" rel="stylesheet" href="Asymmetric%20Routing_files/c504d579-e135-4f75-8335-4906f6c6ce67.css">
<title>Forcepoint | License Center</title>
<meta name="Robots" content="index,nofollow">

	<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<meta name="description" content="">
    <meta name="author" content="info@stonesoft.com">
	<meta name="copyright" content="Stonesoft">
	<meta name="keywords" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<meta http-equiv="imagetoolbar" content="no">
	
	
	<link rel="shortcut icon" href="https://www.forcepoint.com/sites/all/themes/custom/fp_marketing/favicon.ico">
	<style type="text/css" media="all">
@import url('/2012/css/layout/960_16_col.css;jsessionid=75511E94AF508636A8BC7EE93433F6EC');

@import url('/2012/css/layout/style.css;jsessionid=75511E94AF508636A8BC7EE93433F6EC?2');

@import url('/2012/css/layout/styleGE.css;jsessionid=75511E94AF508636A8BC7EE93433F6EC');

@import url('/2012/css/layout/webform.css;jsessionid=75511E94AF508636A8BC7EE93433F6EC');

@import url('/2012/css/layout/custom.css;jsessionid=75511E94AF508636A8BC7EE93433F6EC');

@import url('/2012/css/msc.css;jsessionid=75511E94AF508636A8BC7EE93433F6EC');

@import url('/forcepoint/sites/default/files/css/css_70s7OFUKJQpEGQESnZJsHZW7jaj74sZkykLPwZETJVI.css;jsessionid=75511E94AF508636A8BC7EE93433F6EC');
@import url('/forcepoint/sites/default/files/css/css_d3wUnWmvrhHctLEhCaWLLGnIiCmssBOHHV1kokYIM_o.css;jsessionid=75511E94AF508636A8BC7EE93433F6EC');
@import url('/forcepoint/sites/default/files/css/css_gg1gCFSIzyql55LnGB2465lIcr0K0J_ho0jMfm-dbH8.css;jsessionid=75511E94AF508636A8BC7EE93433F6EC');
@import url('/forcepoint/sites/default/files/css/css_GMoRLOpw_KtU5W9d9kKIuF6AMIShs5f1vlidfo2rte4.css;jsessionid=75511E94AF508636A8BC7EE93433F6EC');
@import url('/forcepoint/sites/default/files/css/css_NtWCy4LHqStBEU8pPZ5gbPpzzm81mWC2qSOuaUQN2qo.css;jsessionid=75511E94AF508636A8BC7EE93433F6EC');
@import url('/forcepoint/sites/default/files/css/css_UICBNJzdO4jy2AtO2tGem7THs_d2sZsBAK5xlXD3MMo.css;jsessionid=75511E94AF508636A8BC7EE93433F6EC');
@import url('/forcepoint/sites/default/files/css/branding-only.css;jsessionid=75511E94AF508636A8BC7EE93433F6EC');

</style>



<script type="text/javascript" async="" src="Asymmetric%20Routing_files/ga.js"></script><script type="text/javascript">
<!--//-->//><!--
var images = new Array()
function preload() {
for (i = 0; i < preload.arguments.length; i++) {
images[i] = new Image()
images[i].src = preload.arguments[i]
}
}
preload(
		"/2012/pictures/buttons/attachfiles-hover.png;jsessionid=75511E94AF508636A8BC7EE93433F6EC",
		"/2012/pictures/buttons/attachfiles-normal.png;jsessionid=75511E94AF508636A8BC7EE93433F6EC",
		"/2012/pictures/buttons/browse2.png;jsessionid=75511E94AF508636A8BC7EE93433F6EC",
		"/2012/pictures/buttons/browse3.png;jsessionid=75511E94AF508636A8BC7EE93433F6EC",
		"/2012/pictures/buttons/login2.png;jsessionid=75511E94AF508636A8BC7EE93433F6EC",
		"/2012/pictures/buttons/login3.png;jsessionid=75511E94AF508636A8BC7EE93433F6EC",
		"/2012/pictures/buttons/register2.png;jsessionid=75511E94AF508636A8BC7EE93433F6EC",
		"/2012/pictures/buttons/register3.png;jsessionid=75511E94AF508636A8BC7EE93433F6EC",
		"/2012/pictures/buttons/submit2.png;jsessionid=75511E94AF508636A8BC7EE93433F6EC",
		"/2012/pictures/buttons/submit3.png;jsessionid=75511E94AF508636A8BC7EE93433F6EC",
		"/2012/pictures/buttons/search2.png;jsessionid=75511E94AF508636A8BC7EE93433F6EC",
		"/2012/pictures/buttons/search3.png;jsessionid=75511E94AF508636A8BC7EE93433F6EC"
);
//--><!
</script>

<script src="Asymmetric%20Routing_files/jquery-1.js">
</script>
<script src="Asymmetric%20Routing_files/jquery.js"></script>
<script src="Asymmetric%20Routing_files/default.js"></script>
	
	<script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-36767224-1']);
	  _gaq.push(['_setDomainName', 'stonesoft.com']);
	  _gaq.push(['_setAllowLinker', true]);
	  _gaq.push(['_trackPageview']);
	
	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	</script>
	
	<!--[if lt IE 9]> 
	    <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script> 
	<![endif]-->
	
</head>

<!--[if lt IE 7 ]> <body class="ie6"> <![endif]-->
<!--[if IE 7 ]>    <body class="ie7"> <![endif]-->
<!--[if IE 8 ]>    <body class="ie8"> <![endif]-->
<!--[if IE 9 ]>    <body class="ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> 
<body> <!--<![endif]--> <!--SET BODY CLASS IF INTERNET EXPLORER-->
	<div id="wrapper">
		<header class="container_16" style="overflow: visible;">

			<div id="logo" class="grid_4">
				<a href="https://my.stonesoft.com/"><img src="Asymmetric%20Routing_files/forcepoint-logo.png"></a>
			</div>
			
		</header>
	
<section class="content area">

<section class="page_top_image">
	<div class="images_content container_16">

		<div class="page_text grid_10 suffix_1">

			<h1>Knowledge Base</h1>
			<p>
			This is the home of Release Notes, Known Issues, FAQs, and other documents that provide important information for customers. 
			</p>
			
		</div>
		
	</div>

</section>
<section class="main_container container_16" id="main_container">


	<div id="MSC_Content" class="main_content grid_12">
		









		




<div id="MSC_KnownIssues">

	<h3 class="bigger_size">What is asymmetric routing?</h3>
	
	<p>What is asymmetric routing? What are the problems with asymmetric 
routing? When can asymmetric routing occur? How to prevent asymmetric 
routing with clustering products for firewalls?
<br>
<br>Asymmetric routing in general is a normal, but unwanted situation in
 an IP network. Asymmetric routing is a situation where for one reason 
or another packets flowing in i.e. TCP connections flow through 
different routes to different directions. As a rough example: Host A and
 B located in different continents are communicating through a TCP 
connection. Segments sent from host A to host B reach the destination 
through Sprint link but segments sent from B to A reach the destination 
through MCI link. 
<br>
<br>Asymmetric routing as described above is not a problem for current 
TCP/IP implementations, since TCP connection does not care which route a
 certain IP packet takes as long as it reaches its destination in a 
reasonable time. 
<br>
<br>Asymmetric routing can occur in a smaller scale also. It could 
happen in a situation where an organization uses two different routes, 
like a VPN and a leased line, for instance, to their branch office. In 
FullCluster technology context, we speak about asymmetric routing when 
we have a situation where segments on a single connection come in to the
 network through one node and go out through another node. 
<br>
<br>Why is asymmetric routing bad?
<br>Asymmetric routing can cause different problems in a FullCluster 
environment depending on the firewall type running together with 
FullCluster.
<br>
<br>With basic packet filtering, asymmetric routing is not a problem 
from the basic firewall functionality point of view. For example 
Gauntlet firewall from Network Associates has an option for doing basic 
packet filtering. Though problems can arise with logging and accounting 
of packet filter rules even with packet filtering. 
<br>
<br>With proxy firewalls, the problems of asymmetric routing will almost
 certainly lead to non-working connections through the firewall proxies.
 Raptor Firewall from Axent Technologies and Gauntlet firewall from 
Network Associates have a lot of proxy firewall features but Firewall-1 
from CheckPoint also has some proxy features, called Security Servers. 
<br>
<br>The way a proxy operates is that instead of connecting to the server
 directly, the client connects to a proxy and using various methods, 
tells the proxy itself to initiate a new connection to the destination 
server. After this stage, the virtual connection between the client and 
the server is actually made up of two connections, one from the client 
to the proxy and another from the proxy to the server. The proxy in 
between is passing and possibly auditing data flowing between the peers.
 
<br>
<br>With current proxy firewall products, the state information of these
 connections is not synchronized between the firewall nodes . Therefore,
 only the node handling the virtual connection between the client and 
the server is able to process packets belonging to this particular 
connection. If the packets flowing in different directions, however, are
 sent to different nodes, the proxy firewall can't operate at all. In 
order to maintain a TCP connection, the firewall node needs to process 
all segments flowing from the client to the proxy, from the proxy to the
 server, from server to the proxy and from the proxy to the client. If 
asymmetric routing occurs this can not be guaranteed. 
<br>
<br>Problems can also arise with CheckPoint Firewall-1, which uses a 
technology called stateful inspection to do packet filtering in most 
cases. The way that stateful inspection works is that when i.e. a TCP 
connection is established an entry of this connection is entered to a 
state table and all segments flowing both ways on the connection after 
that are accepted based on the state table information instead of actual
 rules in the rule base. This has a big performance advantage compared 
to both basic packet filtering and especially to proxy based solutions 
and it eases the rule base administration a lot, since firewall 
administrator can present a connection with a single rule, instead of 
having multiple rules for segments flowing to different directions. 
<br>
<br>Problems arise in an asymmetric routing case with stateful 
inspection because other nodes might not have information about a 
connection in their state tables and they would drop segments as being 
bogus since they don't belong to any live connection found in their 
state tables. CheckPoint Firewall-1 has a technology called state table 
synchronization, which effectively synchronizes state tables between 
cluster nodes. This feature can help to overcome the problems with 
asymmetric routing, but the state table synchronization always has a 
small lag, which can cause problems to live connections. So state table 
synchronization doesn't fully solve the problem. Asymmetric routing can 
also cause incorrect logging and accounting information to be sent to 
the firewall management station. 
<br>
<br>How do FullCluster firewall products prevent asymmetric routing?
<br>FullCluster products prevent asymmetric routing by load balancing 
connections, instead of single packets or segments. Information used to 
make load balancing decisions in the FullCluster Load Balancing 
Algorithm can consist of following parameters depending on the 
overlaying firewall product: Source IP, Destination IP, Source port, 
Destination Port and cluster status information. 
<br>
<br>The Load Balancing Algorithm implemented in the Load Balancing 
Filter works between the NIC driver and firewall kernel module in the 
Operating System TCP/IP stack and uses the above information to separate
 connections from each other. The Load Balancing Algorithm works in a 
symmetric way, which means that as long as the port or IP pair is the 
same the traffic is sent to the same node. 
<br>
<br>Let's examine a basic TCP connection flow from IP address and port 
number point of view: Client host A having IP 10.0.0.1 has opened a HTTP
 connection to server host B having IP 192.168.0.1. The source port of 
the connection is randomly selected on host A, let's assume it's 12567 
and the destination port on host B is 80. 
<br>
<br>Source IP Destination IP Source port Destination port Description 
<br>10.0.0.1 (A) 192.168.0.1 (B) 12765 80 Segment from A to B 
<br>10.0.0.1 (A) 192.168.0.1 (B) 12765 80 Segment from A to B 
<br>192.168.0.1 (B) 10.0.0.1 (A) 80 12765 Segment from B to A 
<br>10.0.0.1 (A) 192.168.0.1 (B) 12765 80 Segment from A to B 
<br>192.168.0.1 (B) 10.0.0.1 (A) 80 12765 Segment from B to A 
<br>
<br>
<br>As we can observe in the above table, the port numbers and IP 
addresses are the same during the whole connection. The only thing 
changing is the order depending weather we're sending data from A to B 
or from B to A. FullCluster Load Balancing Filter ignores the order of 
the information, effectively resulting in same load balancing decision 
regardless of the direction of the data flow. This will ensure that no 
matter which way the packets are flowing they will always be handled by 
the same node, and thus asymmetric routing situations can be avoided. 
<br>
<br>When can asymmetric routing occur?
<br>With normal traffic, FullCluster is able to prevent asymmetric 
routing without any special intervention from the firewall cluster 
administrator in a way described in the previous section. Special 
attention from the administrator is required in cases where you use 
Network Address Translation (NAT) or tunneling Virtual Private Networks 
(VPN). 
<br>
<br>With Hide NAT from internal network to Internet for example, the 
source IP address and source port numbers of the connection change as it
 passes the firewall. Since the information is different on different 
sides of the firewall, asymmetric routing can occur. To avoid this, the 
Load Balancing Filter has to know about any existing Hide NAT rules in 
the firewall rule base. This information can be entered to the 
filter.conf file manually by the administrator and from version 2.0 on, 
it can be fetched automatically from the firewall management station 
using the Web configuration GUI. 
<br>
<br>With Static NAT from internal network to Internet for example, the 
source IP address of the connection changes as it passes the firewall. 
Since the information is different on different sides of the firewall, 
asymmetric routing can occur. To avoid this, the Load Balancing Filter 
has to know about any existing Static NAT rules in the firewall rule 
base. This information can be entered to the filter.conf file manually 
by the administrator or from version 2.0 on, it can be fetched 
automatically from the firewall management station using the Web 
configuration GUI. 
<br>
<br>The situation is similar with tunneling VPN's. Port and IP 
information in tunneled packets is different than in the packets that 
have been de-multiplexed by the firewall doing the VPN tunneling. In 
essence, this means that the information is different on different sides
 of the firewall, so asymmetric routing can occur. To avoid this, the 
Load Balancing Filter has to know about any existing VPN tunnel rules in
 the firewall rule base. This information must be entered to the 
filter.conf file manually by the administrator. 
<br>
<br>Detailed instructions on how to configure the Load Balancing Filter can be found from the FullCluster Manual.
<br></p>
		
			
		
	<table id="issue_table">
	<tbody><tr><td>Type</td><td>FAQ</td></tr>
	<tr><td>Visibility</td><td>Public</td></tr>
	
	</tbody></table>	


	</div>

	</div>
<div class="sidebar grid_4">

		
		
			








<div class="sidebar_item">
	<h5>Knowledge Base Links</h5>
	<ul id="circlebullets">
		
		
				<li><a href="https://my.stonesoft.com/support/search.do;jsessionid=75511E94AF508636A8BC7EE93433F6EC?product=StoneGate">Legacy Knowledge Base</a></li>
			<li><a href="https://my.stonesoft.com/support/browse.do;jsessionid=75511E94AF508636A8BC7EE93433F6EC?browsetype=type&amp;product=StoneGate">Browse by Type</a></li>
			<li><a href="https://my.stonesoft.com/support/browse.do;jsessionid=75511E94AF508636A8BC7EE93433F6EC?browsetype=subject&amp;product=StoneGate">Browse by Subject</a></li>
					
		
	</ul>

</div>	
		
</div>	
	
		
	</section>
</section>
 <div class="panel-pane pane-panels-mini pane-footer">
        <div class="pane-content">
        <footer class="site-footer" role="contentinfo">
        <section class="top-links">
        <nav class="footer-nav wrapper">
        <div class="panel-pane pane-block pane-menu-menu-footer-menu">
        <div class="pane-content">
        <ul class="menu">
            <li class="first leaf"><a href="https://www.forcepoint.com/company/contact-us">Contact Us</a></li>
            <li class="leaf"><a href="https://www.forcepoint.com/free-trials-demos">Free Trials &amp; Demos</a></li>
            <li class="leaf"><a href="https://www.forcepoint.com/company/careers">Careers</a></li>
            <li class="last leaf"><a href="https://www.forcepoint.com/resources/case-studies">Case Studies</a></li>
        </ul>
        </div>
        </div>
        </nav>
        </section>
        <section class="bottom-links">
        <div class="wrapper">
        <div class="panel-pane pane-block pane-menu-menu-footer-social-menu">
        <div class="pane-content">
        <ul class="menu">
            <li class="first leaf linkedin-icon"><a href="http://www.linkedin.com/company/forcepoint" target="_blank">LinkedIn</a></li>
            <li class="leaf facebook-icon"><a href="http://www.facebook.com/websense" target="_blank">Facebook</a></li>
            <li class="leaf twitter-icon"><a href="https://twitter.com/forcepointsec" target="_blank">Twitter</a></li>
            <li class="leaf youtube-icon"><a href="https://www.youtube.com/channel/UC4MbQECdktvwewRlAFwT_-w" target="_blank">YouTube</a></li>
            <li class="last leaf rss-icon"><a href="http://blogs.websense.com/clean-feed.xml" target="_blank">RSS</a></li>
        </ul>
        </div>
        </div>
        <div class="panel-pane pane-ws-footer-info">
        <div class="pane-content">
        <div class="legal-menu">
        <div class="legal"><a href="http://www.forcepoint.com/website-terms-and-conditions">Legal Information</a></div>
        <div class="privacy"><a href="http://www.forcepoint.com/privacy-policy">Privacy Policy</a></div>
        <div class="copyright">© 2016 Forcepoint LLC. All Rights Reserved</div>
        </div>
        </div>
        </div>
        </div>
        </section>
        </footer>
        </div>
        </div>


</div>




</body></html>
<!--View rendered in 6ms -->
<!--Page completely process in
16 
-->